import t,{Component as e}from"react";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}function i(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function l(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function c(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return i(t)}function u(t){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},u(t)}function f(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function p(t){if(Array.isArray(t))return t}function h(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i=[],s=!0,l=!1;try{for(r=r.call(t);!(s=(n=r.next()).done)&&(i.push(n.value),!e||i.length!==e);s=!0);}catch(t){l=!0,o=t}finally{try{s||null==r.return||r.return()}finally{if(l)throw o}}return i}}function d(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function g(t,e){if(t){if("string"==typeof t)return d(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?d(t,e):void 0}}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function y(t,e){return p(t)||h(t,e)||g(t,e)||m()}function v(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];if(e){for(var n=[],o=0;o<e.length;o++){var i=e[o];if(i){var s=a(i);if("string"===s||"number"===s)n.push(i);else if("object"===s){var l=Array.isArray(i)?i:Object.entries(i).map((function(t){var e=y(t,2);return e[1]?e[0]:null}));n=l.length?n.concat(l.filter((function(t){return!!t}))):n}}}return n.join(" ")}}var w=function(){function t(){r(this,t)}return o(t,null,[{key:"equals",value:function(t,e,r){return r&&t&&"object"===a(t)&&e&&"object"===a(e)?this.resolveFieldData(t,r)===this.resolveFieldData(e,r):this.deepEquals(t,e)}},{key:"deepEquals",value:function(t,e){if(t===e)return!0;if(t&&e&&"object"==a(t)&&"object"==a(e)){var r,n,o,i=Array.isArray(t),s=Array.isArray(e);if(i&&s){if((n=t.length)!==e.length)return!1;for(r=n;0!=r--;)if(!this.deepEquals(t[r],e[r]))return!1;return!0}if(i!==s)return!1;var l=t instanceof Date,c=e instanceof Date;if(l!==c)return!1;if(l&&c)return t.getTime()===e.getTime();var u=t instanceof RegExp,f=e instanceof RegExp;if(u!==f)return!1;if(u&&f)return t.toString()===e.toString();var p=Object.keys(t);if((n=p.length)!==Object.keys(e).length)return!1;for(r=n;0!=r--;)if(!Object.prototype.hasOwnProperty.call(e,p[r]))return!1;for(r=n;0!=r--;)if(!this.deepEquals(t[o=p[r]],e[o]))return!1;return!0}return t!=t&&e!=e}},{key:"resolveFieldData",value:function(t,e){if(t&&Object.keys(t).length&&e){if(this.isFunction(e))return e(t);if(-1===e.indexOf("."))return t[e];for(var r=e.split("."),n=t,o=0,i=r.length;o<i;++o){if(null==n)return null;n=n[r[o]]}return n}return null}},{key:"isFunction",value:function(t){return!!(t&&t.constructor&&t.call&&t.apply)}},{key:"findDiffKeys",value:function(t,e){return t&&e?Object.keys(t).filter((function(t){return!e.hasOwnProperty(t)})).reduce((function(e,r){return e[r]=t[r],e}),{}):{}}},{key:"reorderArray",value:function(t,e,r){var n;if(t&&e!==r){if(r>=t.length)for(n=r-t.length;1+n--;)t.push(void 0);t.splice(r,0,t.splice(e,1)[0])}}},{key:"findIndexInList",value:function(t,e){var r=-1;if(e)for(var n=0;n<e.length;n++)if(e[n]===t){r=n;break}return r}},{key:"getJSXElement",value:function(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];return this.isFunction(t)?t.apply(void 0,r):t}},{key:"removeAccents",value:function(t){return t&&t.search(/[\xC0-\xFF]/g)>-1&&(t=t.replace(/[\xC0-\xC5]/g,"A").replace(/[\xC6]/g,"AE").replace(/[\xC7]/g,"C").replace(/[\xC8-\xCB]/g,"E").replace(/[\xCC-\xCF]/g,"I").replace(/[\xD0]/g,"D").replace(/[\xD1]/g,"N").replace(/[\xD2-\xD6\xD8]/g,"O").replace(/[\xD9-\xDC]/g,"U").replace(/[\xDD]/g,"Y").replace(/[\xDE]/g,"P").replace(/[\xE0-\xE5]/g,"a").replace(/[\xE6]/g,"ae").replace(/[\xE7]/g,"c").replace(/[\xE8-\xEB]/g,"e").replace(/[\xEC-\xEF]/g,"i").replace(/[\xF1]/g,"n").replace(/[\xF2-\xF6\xF8]/g,"o").replace(/[\xF9-\xFC]/g,"u").replace(/[\xFE]/g,"p").replace(/[\xFD\xFF]/g,"y")),t}},{key:"isEmpty",value:function(t){return null==t||""===t||Array.isArray(t)&&0===t.length||"object"===a(t)&&0===Object.keys(t).length}},{key:"isNotEmpty",value:function(t){return!this.isEmpty(t)}}]),t}();function b(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function S(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?b(Object(r),!0).forEach((function(e){f(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):b(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var O=function(n){l(p,e);var s,a,f=(s=p,a=x(),function(){var t,e=u(s);if(a){var r=u(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return c(this,t)});function p(t){var e;r(this,p);var n=(e=f.call(this,t)).isBoth();return e.state={first:n?{rows:0,cols:0}:0,last:n?{rows:0,cols:0}:0,numItemsInViewport:n?{rows:0,cols:0}:0,numToleratedItems:t.numToleratedItems,loading:!1},e.onScroll=e.onScroll.bind(i(e)),e.lastScrollPos=n?{top:0,left:0}:0,e}return o(p,[{key:"scrollTo",value:function(t){this.element&&this.element.scrollTo(t)}},{key:"scrollToIndex",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"auto",n=this.isBoth(),o=this.isHorizontal(),i=this.state.first,s=this.props.itemSize,l=this.getContentPadding(),a=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return t<=e.state.numToleratedItems?0:t},c=function(t,e,r){return t*e+r},u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.scrollTo({left:t,top:n,behavior:r})};if(n){var f={rows:a(t[0]),cols:a(t[1])};(f.rows!==i.rows||f.cols!==i.cols)&&u(c(f.cols,s[1],l.left),c(f.rows,s[0],l.top))}else{var p=a(t);p!==i&&(o?u(c(p,s,l.left),0):u(0,c(p,s,l.top)))}}},{key:"scrollInView",value:function(t,e){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"auto";if(e){var o=this.isBoth(),i=this.isHorizontal(),s=this.getRenderedRange(),l=s.first,a=s.viewport,c=this.props.itemSize,u=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return r.scrollTo({left:t,top:e,behavior:n})},f="to-start"===e,p="to-end"===e;if(f){if(o)a.first.rows-l.rows>t[0]?u(a.first.cols*c,(a.first.rows-1)*c):a.first.cols-l.cols>t[1]&&u((a.first.cols-1)*c,a.first.rows*c);else if(a.first-l>t){var h=(a.first-1)*c;i?u(h,0):u(0,h)}}else if(p)if(o)a.last.rows-l.rows<=t[0]+1?u(a.first.cols*c,(a.first.rows+1)*c):a.last.cols-l.cols<=t[1]+1&&u((a.first.cols+1)*c,a.first.rows*c);else if(a.last-l<=t+1){var d=(a.first+1)*c;i?u(d,0):u(0,d)}}else this.scrollToIndex(t,n)}},{key:"getRenderedRange",value:function(){var t=this.isBoth(),e=this.isHorizontal(),r=this.state,n=r.first,o=r.last,i=r.numItemsInViewport,s=this.props.itemSize,l=function(t,e){return Math.floor(t/(e||t))},a=n,c=0;if(this.element){var u=this.element.scrollTop,f=this.element.scrollLeft;if(t)c={rows:(a={rows:l(u,s[0]),cols:l(f,s[1])}).rows+i.rows,cols:a.cols+i.cols};else c=(a=l(e?f:u,s))+i}return{first:n,last:o,viewport:{first:a,last:c}}}},{key:"isHorizontal",value:function(){return"horizontal"===this.props.orientation}},{key:"isBoth",value:function(){return"both"===this.props.orientation}},{key:"calculateOptions",value:function(){var t=this,e=this.isBoth(),r=this.isHorizontal(),n=this.state.first,o=this.props.itemSize,i=this.getContentPadding(),s=this.element?this.element.offsetWidth-i.left:0,l=this.element?this.element.offsetHeight-i.top:0,a=function(t,e){return Math.ceil(t/(e||t))},c=e?{rows:a(l,o[0]),cols:a(s,o[1])}:a(r?s:l,o),u=this.state.numToleratedItems||Math.ceil((e?c.rows:c)/2),f=function(e,r,n){return t.getLast(e+r+(e<u?2:3)*u,n)},p={numItemsInViewport:c,last:e?{rows:f(n.rows,c.rows),cols:f(n.cols,c.cols,!0)}:f(n,c),numToleratedItems:u};this.props.showLoader&&(p.loaderArr=Array.from({length:e?c.rows:c})),this.setState(p,(function(){t.props.lazy&&t.props.onLazyLoad&&t.props.onLazyLoad({first:t.state.first,last:t.state.last})}))}},{key:"getLast",value:function(t,e){return this.props.items?Math.min(e?this.props.items[0].length:this.props.items.length,t):0}},{key:"getContentPadding",value:function(){if(this.content){var t=getComputedStyle(this.content),e=parseInt(t.paddingLeft,10),r=parseInt(t.paddingRight,10),n=parseInt(t.paddingTop,10),o=parseInt(t.paddingBottom,10);return{left:e,right:r,top:n,bottom:o,x:e+r,y:n+o}}return{left:0,right:0,top:0,bottom:0,x:0,y:0}}},{key:"setSize",value:function(){var t=this;if(this.element){var e=this.isBoth(),r=this.isHorizontal(),n=this.element.parentElement,o=this.props.scrollWidth||"".concat(this.element.offsetWidth||n.offsetWidth,"px"),i=this.props.scrollHeight||"".concat(this.element.offsetHeight||n.offsetHeight,"px"),s=function(e,r){return t.element.style[e]=r};e?(s("height",i),s("width",o)):r?s("width",o):s("height",i)}}},{key:"setSpacerSize",value:function(){var t=this,e=this.props.items;if(this.spacer&&e){var r=this.isBoth(),n=this.isHorizontal(),o=this.props.itemSize,i=this.getContentPadding(),s=function(e,r,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return t.spacer.style[e]=(r||[]).length*n+o+"px"};r?(s("height",e[0],o[0],i.y),s("width",e[1],o[1],i.x)):n?s("width",e,o,i.x):s("height",e,o,i.y)}}},{key:"setContentPosition",value:function(t){var e=this;if(this.content){var r=this.isBoth(),n=this.isHorizontal(),o=t?t.first:this.state.first,i=this.props.itemSize,s=function(t,e){return t*e},l=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.content.style.transform="translate3d(".concat(t,"px, ").concat(r,"px, 0)")};if(r)l(s(o.cols,i[1]),s(o.rows,i[0]));else{var a=s(o,i);n?l(a,0):l(0,a)}}}},{key:"onScrollPositionChange",value:function(t){var e=this,r=t.target,n=this.isBoth(),o=this.isHorizontal(),i=this.state,s=i.first,l=i.last,a=i.numItemsInViewport,c=i.numToleratedItems,u=this.props.itemSize,f=this.getContentPadding(),p=function(t,e){return t?t>e?t-e:t:0},h=function(t,e){return Math.floor(t/(e||t))},d=function(t,e,r,n,o){return t<=c?c:o?r-n-c:e+c-1},g=function(t,e,r,n,o,i){return t<=c?0:i?t<e?r:t-c:t>e?r:t-2*c},m=function(t,r,n,o,i){var s=r+o+2*c;return t>=c&&(s+=c+1),e.getLast(s,i)},y=p(r.scrollTop,f.top),v=p(r.scrollLeft,f.left),w=0,b=l,S=!1;if(n){var x=this.lastScrollPos.top<=y,O=this.lastScrollPos.left<=v,k={rows:h(y,u[0]),cols:h(v,u[1])},E={rows:d(k.rows,s.rows,l.rows,a.rows,x),cols:d(k.cols,s.cols,l.cols,a.cols,O)};w={rows:g(k.rows,E.rows,s.rows,0,0,x),cols:g(k.cols,E.cols,s.cols,0,0,O)},b={rows:m(k.rows,w.rows,0,a.rows),cols:m(k.cols,w.cols,0,a.cols,!0)},S=w.rows!==s.rows||w.cols!==s.cols||b.rows!==l.rows||b.cols!==l.cols,this.lastScrollPos={top:y,left:v}}else{var I=o?v:y,C=this.lastScrollPos<=I,j=h(I,u);b=m(j,w=g(j,d(j,s,l,a,C),s,0,0,C),0,a),S=w!==s||b!==l,this.lastScrollPos=I}return{first:w,last:b,isRangeChanged:S}}},{key:"onScrollChange",value:function(t){var e=this,r=this.onScrollPositionChange(t);if(r.isRangeChanged){var n={first:r.first,last:r.last};this.setContentPosition(n),this.props.lazy&&this.props.onLazyLoad&&this.props.onLazyLoad(n),this.setState(n,(function(){e.props.onScrollIndexChange&&e.props.onScrollIndexChange(n)}))}}},{key:"onScroll",value:function(t){var e=this;if(this.props.onScroll&&this.props.onScroll(t),this.props.delay){if(this.scrollTimeout&&clearTimeout(this.scrollTimeout),!this.state.loading&&this.props.showLoader)this.onScrollPositionChange(t).isRangeChanged&&this.setState({loading:!0});this.scrollTimeout=setTimeout((function(){e.onScrollChange(t),e.state.loading&&e.props.showLoader&&!e.props.lazy&&e.setState({loading:!1})}),this.props.delay)}else this.onScrollChange(t)}},{key:"getOptions",value:function(t,e){return{index:t,count:e,first:0===t,last:t===e-1,even:t%2==0,odd:t%2!=0,props:this.props}}},{key:"init",value:function(){this.setSize(),this.calculateOptions(),this.setSpacerSize()}},{key:"componentDidMount",value:function(){this.init()}},{key:"componentDidUpdate",value:function(t,e){t.itemSize===this.props.itemSize&&t.items&&t.items.length===(this.props.items||[]).length||this.init(),this.props.lazy&&t.loading!==this.props.loading&&this.state.loading!==this.props.loading&&this.setState({loading:this.props.loading}),t.orientation!==this.props.orientation&&(this.lastScrollPos=this.isBoth()?{top:0,left:0}:0)}},{key:"renderItem",value:function(e,r,n,o){var i=this.getOptions(r,n),s=w.getJSXElement(this.props.itemTemplate,o||e,i);return t.createElement(t.Fragment,{key:r},s)}},{key:"renderItems",value:function(){var t=this,e=this.props.items;if(e&&!this.state.loading){var r=this.isBoth(),n=this.state,o=n.first,i=n.last,s=e.length;return r?e.slice(o.rows,i.rows).map((function(e,r){var n=e.slice(o.cols,i.cols);return t.renderItem(e,o.rows+r,s,n)})):e.slice(o,i).map((function(e,r){return t.renderItem(e,o+r,s)}))}return null}},{key:"renderLoaderItem",value:function(e,r,n){var o=S(S({},this.getOptions(e,r)),n||{}),i=w.getJSXElement(this.props.loadingTemplate,o);return t.createElement(t.Fragment,{key:e},i)}},{key:"renderLoader",value:function(){var e=this;if(this.state.loading){var r=v("p-virtualscroller-loader",{"p-component-overlay":!this.props.loadingTemplate}),n=t.createElement("i",{className:"p-virtualscroller-loading-icon pi pi-spinner pi-spin"});if(this.props.loadingTemplate){var o=this.isBoth(),i=this.state.numItemsInViewport,s=o?i.rows:i;n=this.state.loaderArr.map((function(t,r){return e.renderLoaderItem(r,s,o&&{numCols:i.cols})}))}return t.createElement("div",{className:r},n)}return null}},{key:"renderContent",value:function(){var e=this,r=this.renderItems(),n=t.createElement("div",{className:"p-virtualscroller-content",ref:function(t){return e.content=t}},r);if(this.props.contentTemplate){var o=this.state;return w.getJSXElement(this.props.contentTemplate,{className:"p-virtualscroller-content",ref:function(t){return e.content=t},children:r,element:n,props:this.props,loading:o.loading,first:o.first,last:o.last})}return n}},{key:"render",value:function(){var e=this,r=v("p-virtualscroller",{"p-both-scroll":this.isBoth(),"p-horizontal-scroll":this.isHorizontal()},this.props.className),n=this.renderLoader(),o=this.renderContent();return t.createElement("div",{ref:function(t){return e.element=t},className:r,style:this.props.style,onScroll:this.onScroll},o,t.createElement("div",{ref:function(t){return e.spacer=t},className:"p-virtualscroller-spacer"}),n)}}]),p}();f(O,"defaultProps",{id:null,style:null,className:null,items:null,itemSize:0,scrollHeight:null,scrollWidth:null,orientation:"vertical",numToleratedItems:null,delay:0,lazy:!1,showLoader:!1,loadingTemplate:null,itemTemplate:null,contentTemplate:null,onScroll:null,onScrollIndexChange:null,onLazyLoad:null});export{O as VirtualScroller};
